const app=document.getElementById('app');window.addEventListener('hashchange',render);render();function page(h){app.innerHTML=h;}async function api(p,o={}){const r=await fetch(API_BASE+p,{credentials:'include',...o});return r.json();}async function render(){const h=location.hash||'#/';if(h==='#/'){page(`<div class='card'><h2>DLCard Frontend</h2><button onclick='login()'>使用 Google 登入</button><pre id='out'>讀取後端中...</pre></div>`);try{const d=await api('/');document.getElementById('out').textContent=JSON.stringify(d,null,2);}catch{document.getElementById('out').textContent='後端無法連線';}}if(h==='#/me'){page(`<div class='card'><h2>會員資料</h2><pre id='me'>讀取中...</pre></div>`);const d=await api('/me');document.getElementById('me').textContent=JSON.stringify(d,null,2);if(d.need_bind_phone){location.hash='#/bind-phone';}}if(h==='#/bind-phone'){page(`<div class='card'><h2>手機綁定</h2><input id='phone' placeholder='09xxxxxxxx'><button onclick='bindPhone()'>送出</button><pre id='msg'></pre></div>`);}if(h==='#/wallet'){page(`<div class='card'><h2>錢包</h2><pre id='wallet'>讀取中...</pre></div>`);const d=await api('/wallet');document.getElementById('wallet').textContent=JSON.stringify(d,null,2);}if(h==='#/mall'){page(`<div class='card'><h2>商城</h2><pre id='mall'>讀取中...</pre></div>`);const d=await api('/malls');document.getElementById('mall').textContent=JSON.stringify(d,null,2);}if(h==='#/admin'){page(`<div class='card'><h2>Admin</h2><input id='key' placeholder='Admin API Key'><button onclick='loadAdmin()'>讀取會員</button><pre id='admin'></pre></div>`);}}async function login(){const d=await api('/auth/google');if(d.auth_url)location.href=d.auth_url;}async function bindPhone(){const phone=document.getElementById('phone').value;const r=await api('/bind-phone',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone})});document.getElementById('msg').textContent=JSON.stringify(r,null,2);if(r.ok)setTimeout(()=>location.hash='#/me',1000);}async function loadAdmin(){const key=document.getElementById('key').value;const r=await fetch(API_BASE+'/admin/members',{headers:{'X-Admin-Api-Key':key}});const d=await r.json();document.getElementById('admin').textContent=JSON.stringify(d,null,2);}
